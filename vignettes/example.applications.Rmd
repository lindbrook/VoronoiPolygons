---
title: "Example Applications"
author: "lindbrook"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Example Applications}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)

library(VoronoiPolygons)
library(cholera)
```

Using just the locations of sites or landmarks, Voronoi tessellation partitions a space into cells or tiles that represent those sites' neighborhoods (i.e., their catchment or service areas). This package adds to the functionality of the 'deldir' package by computing the vertices of those tiles so that we can leverage functions that use polygons. Doing so simplifies tasks like color coding neighborhoods or counting elements of interest within neighborhoods.

As an example, I use data from John Snow's map of the 1854 cholera outbreak in the Soho area London.

## Coloring Neighborhoods

```{r coloring, fig.align = "center", fig.width = 5, fig.height = 5, echo = TRUE, eval = TRUE}
# compute vertices of Voronoi tiles
polygon.vertices <- VoronoiPolygons(sites = cholera::pumps,
  cases = cholera::roads, plot.frame = "cases")

# generate unique colors with alpha transparency
snow.colors <- grDevices::adjustcolor(cholera::snowColors(), alpha.f = 1/3)

# plot John Snow's map
cholera::snowMap(add.cases = FALSE)

# plot color coded fatalities
cholera::addNeighborhoodCases(metric = "euclidean")

# plot color coded polygons
invisible(lapply(seq_along(polygon.vertices), function(i) {
  polygon(polygon.vertices[[i]], col = snow.colors[[i]])
}))
```

## Counting Cases

To count the number of cases within each neighborhood, we can use sp::point.in.polygon().

```{r counting, echo = TRUE, eval = TRUE}
# compute vertices of Voronoi tiles
polygon.vertices <- VoronoiPolygons(sites = cholera::pumps,
  cases = cholera::roads, plot.frame = "cases")

# locations of the 578 fatalies in Soho
cases <- cholera::fatalities.unstacked

# count fatalities by neighborhood
census <- lapply(polygon.vertices, function(tile) {
  sp::point.in.polygon(cases$x, cases$y, tile$x, tile$y)
})

# ID for the 13 water pumps in Soho
neighborhood.pump <- paste0("p", cholera::pumps$id)

# count of fatalities by neighborhoo
stats::setNames(vapply(census, sum, integer(1L)), neighborhood.pump)
```
